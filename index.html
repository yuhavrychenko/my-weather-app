<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Weather App</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9"
      crossorigin="anonymous"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&family=Roboto+Flex:opsz,wght@8..144,100;8..144,200;8..144,300;8..144,400&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/weather-icons.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <div class="container">
      <div class="card card-custom mx-auto mt-4 p-2">
        <div class="card-body">
          <form class="row p-3" id="search-form">
            <div class="col-8">
              <input
                type="text"
                class="form-control"
                placeholder="Enter a city name..."
                id="search-input"
                autocomplete="off"
              />
            </div>
            <div class="col-md-2">
              <button type="submit" class="btn btn-primary w-90">Search</button>
            </div>
            <div class="col-md-2">
              <button
                type="click"
                class="btn btn-success w-90"
                id="current-location"
              >
                Current
              </button>
            </div>
          </form>
          <div class="row mx-auto p-3">
            <div class="col-md-7">
              <h1 id="city"></h1>
              <h2>
                <div id="date-and-time">
                  <div>
                    <span id="month"></span> <span id="date"></span>,
                    <span id="day-time"></span>
                    <span id="day"></span>
                    <span id="hours"></span><span id="minutes"></span>
                  </div>
                </div>
              </h2>
              <div class="mt-auto">
                <span>Humidity: <span id="humidity"></span>%</span>,
                <span>Wind: <span id="wind"></span> km/hour</span>
              </div>
            </div>
            <div class="col-md-5 mx-auto">
              <div id="current-temperature">
                <img src="" alt="" id="weather-current-day-icon" />
                <strong id="degree"></strong>
                <span class="units"
                  ><a id="celsius" href="#">째C </a> |
                  <a id="fahrenheit" href="#">째F</a>
                </span>
              </div>
              <div id="current-weather-description"></div>
            </div>
          </div>
          <hr class="my-2 custom-hr" />
          <div class="weather-forecast">
            <div class="row">
              <div class="col-md-2 text-center">
                <h2 class="weather-forecast-day">Sat</h2>
                <img src="" alt="" id="weather-forecast-icon" />
                <div class="weather-forecast-temperatures">
                  <span class="weather-forecast-temperature-max">20째</span
                  ><span class="weather-forecast-temperature-min">17째</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <footer>
        <a
          href="https://github.com/yuhavrychenko/my-weather-app"
          target="_blank"
          >Open-source code</a
        >
        hosted on
        <a href="https://scintillating-dusk-05d2ac.netlify.app/" arget="_blank"
          >Netlify</a
        >, by Yuliia Havrychenko
      </footer>
    </div>
    <script>
      // Get current date and time
      let now = new Date();
      const months = [
        "January",
        "February",
        "March",
        "April",
        "May",
        "June",
        "July",
        "August",
        "September",
        "October",
        "November",
        "December",
      ];
      let month = months[now.getMonth()];
      let currentMonth = document.querySelector("#month");
      currentMonth.innerHTML = `${month}`;

      let date = now.getDate();
      let currentDate = document.querySelector("#date");
      currentDate.innerHTML = `${date}`;
      const daysOfWeek = [
        "Sunday",
        "Monday",
        "Tuesday",
        "Wednesday",
        "Thursday",
        "Friday",
        "Saturday",
      ];
      let day = daysOfWeek[now.getDay()];
      let currentDay = document.querySelector("#day");
      let hours = now.getHours();
      let currentHour = document.querySelector("#hours");
      let formattedHour = hours < 10 ? `0${hours}` : `${hours}`;
      let minutes = now.getMinutes();
      let currentMinutes = document.querySelector("#minutes");
      let formattedMinutes = minutes < 10 ? `0${minutes}` : `${minutes}`;
      let dayTime = document.querySelector("#day-time");
      dayTime.innerHTML = `${day} ${formattedHour}:${formattedMinutes}`;

      // Function to display weather information
      function showTemperature(response) {
        document.querySelector("#city").innerHTML = response.data.city;
        let temperature = Math.round(response.data.temperature.current);
        let temperatureElement = document.querySelector("#degree");
        temperatureElement.innerHTML = `${temperature}`;
        let description = document.querySelector(
          "#current-weather-description"
        );
        description.innerHTML = response.data.condition.description;
        let humidity = document.querySelector("#humidity");
        humidity.innerHTML = Math.round(response.data.temperature.humidity);
        let wind = document.querySelector("#wind");
        wind.innerHTML = Math.round(response.data.wind.speed);
        let icon = response.data.condition.icon;
        let currentDayIcon = document.querySelector(
          "#weather-current-day-icon"
        );
        currentDayIcon.setAttribute(
          "src",
          `http://shecodes-assets.s3.amazonaws.com/api/weather/icons/${icon}.png`
        );
        currentDayIcon.setAttribute("alt", response.data.condition.icon);
      }
      // Function to fetch weather data for a city on load
      function search(city) {
        let apiUrl = `https://api.shecodes.io/weather/v1/current?query=${city}&key=o2bde3ft15fc0e6fbb7362fdb8a79c4f&units=metric`;
        axios.get(apiUrl).then(showTemperature);
      }
      // Event listener for search form submission
      function handleSubmit(event) {
        event.preventDefault();
        let city = document.querySelector("#search-input").value;
        search(city);
      }
      // Attach event listener to the search form
      let searchForm = document.querySelector("#search-form");
      searchForm.addEventListener("submit", handleSubmit);

      // Get the current location button element
      let currentLocationButton = document.querySelector("#current-location");
      // Function to get and display current weather for user's current location
      function getCurrentWeatherForCurrentLocation(event) {
        event.preventDefault();
        // Function to handle current position
        function handlePosition(position) {
          let lat = position.coords.latitude;
          let lon = position.coords.longitude;
          let apiKey = "o2bde3ft15fc0e6fbb7362fdb8a79c4f";
          let apiUrl = `https://api.shecodes.io/weather/v1/current?lon=${lon}&lat=${lat}&key=${apiKey}&units=metric`;

          // Fetch weather data and call the display function to show the weather parameters
          axios.get(apiUrl).then(showTemperature);
        }
        // Get the current location button element
        navigator.geolocation.getCurrentPosition(handlePosition);
      }
      // Attach event listener to the button
      currentLocationButton.addEventListener(
        "click",
        getCurrentWeatherForCurrentLocation
      );
      // Display weather for Berlin when the page loads
      search("Berlin");

      function displayFahrenheit(event) {
        event.preventDefault();
        let temperatureElement = document.querySelector("#degree");
        let currentTemperature = parseInt(temperatureElement.textContent);
        let fahrenheitTemperature = Math.round(
          (currentTemperature * 9) / 5 + 32
        );
        temperatureElement.textContent = `${fahrenheitTemperature}`;
      }

      function displayCelsius(event) {
        event.preventDefault();
        let temperatureElement = document.querySelector("#degree");
        let currentTemperature = parseInt(temperatureElement.textContent);
        let celsiusTemperature = Math.round(
          ((currentTemperature - 32) * 5) / 9
        );
        temperatureElement.textContent = `${celsiusTemperature}`;
      }

      let fahrenheitUnit = document.querySelector("#fahrenheit");
      let celsiusUnit = document.querySelector("#celsius");

      fahrenheitUnit.addEventListener("click", displayFahrenheit);
      celsiusUnit.addEventListener("click", displayCelsius);
    </script>
  </body>
</html>
